---
title: 内存屏障
date: 2017-06-30 22:49:49
tags: Disruptor
categories: Java, Disruptor
---

### 1. 什么是内存屏障？
它是一个CPU指令，用于：  
- 确保一些特定操作执行的顺序；  
- 影响一些数据的可见性；      
1. ==编译器和CPU==可以**在保证输出结果一样的情况下对指令重排序，使性能得到优化。插入一个内存屏障，相当于告诉CPU和编译器先于这个命令的必须先执行，后域这个命令的必须后执行。**    
2. **内存屏障的另一个作用是强制更新一次不同CPU的缓存。例如一个写屏障会把这个屏障前写入的数据刷新到缓存，这样任何视试图读取该数据的线程得到最新值，而不用考虑是被哪个CPU核心或者哪颗CPU执行的**  

这意味着如果你对一个volatile字段进行写操作，你必须知道：  
1、一旦你完成写入，任何访问这个字段的线程将会得到最新的值。  
2、在你写入前，会保证所有之前发生的事已经发生，并且任何更新过的数据值也是可见的，因为内存屏障会把之前的写入值都刷新到缓存。  
